/*
 * Copyright © 2016-2018 The ET-iLink Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* eslint-disable import/no-commonjs */
/* eslint-disable global-require */
/* eslint-disable import/no-nodejs-modules */

// const path = require('path');
const axios = require('axios');

function postCrackWidth(point) {
    axios.post('http://cf.beidouapp.com:8080/api/v1/GbGuHQkbgeQcAoFd3GLF/telemetry', //A监测点 
        point).then(res => {
            console.log(res.status);
        }).catch(e => {
            // console.info(e);
        })
}

function postCrackDeepth(pt) {
    axios.post('http://cf.beidouapp.com:8080/api/v1/mvjPD7zvq7CqkzmyPOSi/telemetry', //A巡视员 
        ptJson).then(res => {
            console.info(res)
        }).catch(e => {
            console.info(e)
        })
}

let pt = { "裂缝宽度-----": 0.16, idType: "CRACK-ID", alarmCnt: 10.79 };
postCrackWidth(pt);

let pt2 = { "裂缝深度": 0.4, idType: "CRACK", alarmCnt: 1 };
//postCrackDeepth(pt2);

/*
var fRead = fs.createReadStream('./taxi/Taxi_175');
var objReadline = readline.createInterface({
    input: fRead,
    crlfDelay: Infinity
});
var arrPTS_ = new Array();
objReadline.on('line', function (line) {
    console.log('line:' + line);
    let arr = line.split(',');
    let pt = {latitude:0,longitude:0,speed:0,energy:0};
    pt.longitude = Number(arr[2]);
    pt.latitude = Number(arr[3]);
    pt.speed = Number(arr[4]);
    pt.energy = Number(arr[5]);
    arrPTS_.push(pt);
    //objReadline.pause();
});
objReadline.on('close', function () {
    console.log('closed!');
    // callback(arr);
});




let count_ = 0,
    timer_ = setInterval((str, num) => {
        count_++;
        console.log(str, count_);
        postGps(count_++);
        //objReadline.resume();
        if (count_ >= num)
            clearInterval(timer_);
    }, 1000, 'total times', 3);

var ttt = [
    { 
        "id": { "id": "f5819890-dd0b-11e8-9764-d533b1141d19" }, 
        "createdTime": 0, 
        "type": "ENRICHMENT", 
        "scope": "TENANT", 
        "name": "originator telemetry", 
        "clazz": "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode", 
        "configurationDescriptor": { 
            "nodeDefinition": { 
                "details": "The node allows you to select fetch mode \
                    <b>FIRST/LAST/ALL</b> to fetch telemetry of certain time range \
                    that are added into Message metadata without any prefix. \
                    If selected fetch mode <b>ALL</b> Telemetry will be added like \
                    array into Message Metadata where <b>key</b> is Timestamp and <b>value</b> \
                    is value of Telemetry. If selected fetch mode <b>FIRST</b> or <b>LAST</b> \
                    Telemetry will be added like string without Timestamp",
                    "description": "Add Message Originator Telemetry for selected time range into Message Metadata\n",
                "inEnabled": true, 
                "outEnabled": true,
                "relationTypes": ["Success", "Failure"],
                "customRelations": false,
                "defaultConfiguration": { 
                    "startInterval": 2,
                    "endInterval": 1,
                    "startIntervalTimeUnit": "MINUTES", 
                    "endIntervalTimeUnit": "MINUTES",
                    "fetchMode": "FIRST",
                    "latestTsKeyNames": [] },
                "uiResources": ["static/rulenode/rulenode-core-config.js"],
                "configDirective": "tbEnrichmentNodeGetTelemetryFromDatabase",
                "icon": "", "iconUrl": "", "docUrl": "" 
            } 
        },
        "actions": null 
    }, 
    {
        "id": { "id": "f58da680-dd0b-11e8-9764-d533b1141d19" }, 
        "createdTime": 0,
        "type": "ENRICHMENT", 
        "scope": "TENANT", 
        "name": "tenant attributes", 
        "clazz": "org.thingsboard.rule.engine.metadata.TbGetTenantAttributeNode", 
        "configurationDescriptor": { 
            "nodeDefinition": { 
                "details": "If Attributes enrichment configured, server scope attributes are\
                added into Message metadata. If Latest Telemetry enrichment configured, latest \
                telemetry added into metadata. To access those attributes in other nodes this \
                template can be used <code>metadata.temperature</code>.", 
                "description": "Add Originators Tenant Attributes or Latest Telemetry into Message Metadata", 
                "inEnabled": true, 
                "outEnabled": true, 
                "relationTypes": ["Success", "Failure"], 
                "customRelations": false, 
                "defaultConfiguration": { "attrMapping": { "temperature": "tempo" }, "telemetry": false }, 
                "uiResources": ["static/rulenode/rulenode-core-config.js", 
                "static/rulenode/rulenode-core-config.css"], 
                "configDirective": "tbEnrichmentNodeTenantAttributesConfig", 
                "icon": "", "iconUrl": "", "docUrl": "" 
            } 
        }, 
        "actions": null
    }, 
    { 
        "id": { "id": "f59547a0-dd0b-11e8-9764-d533b1141d19" }, 
        "createdTime": 0, 
        "type": "ENRICHMENT", 
        "scope": "TENANT", 
        "name": "originator attributes", 
        "clazz": "org.thingsboard.rule.engine.metadata.TbGetAttributesNode", 
        "configurationDescriptor": { 
            "nodeDefinition": {
                "details": "If Attributes enrichment configured, <b>CLIENT/SHARED/SERVER</b> \
                attributes are added into Message metadata with specific prefix: <i>cs/shared/ss</i>.\
                 Latest telemetry value added into metadata without prefix. To access those attributes \
                 in other nodes this template can be used <code>metadata.cs_temperature</code>\
                  or <code>metadata.shared_limit</code> ", 
                "description": "Add Message Originator Attributes or Latest Telemetry into Message Metadata", 
                "inEnabled": true, 
                "outEnabled": true, 
                "relationTypes": ["Success", "Failure"], 
                "customRelations": false, 
                "defaultConfiguration": { 
                    "clientAttributeNames": [], 
                    "sharedAttributeNames": [], 
                    "serverAttributeNames": [], 
                    "latestTsKeyNames": [] 
                }, 
                "uiResources": ["static/rulenode/rulenode-core-config.js"], 
                "configDirective": "tbEnrichmentNodeOriginatorAttributesConfig", 
                "icon": "", 
                "iconUrl": "", 
                "docUrl": "" 
            } 
        }, 
        "actions": null 
    },
    { "id": { "id": "f59fa7e0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "ENRICHMENT", "scope": "TENANT", "name": "originator fields", "clazz": "org.thingsboard.rule.engine.metadata.TbGetOriginatorFieldsNode", "configurationDescriptor": { "nodeDefinition": { "details": "Will fetch fields values specified in mapping. If specified field is not part of originator fields it will be ignored.", "description": "Add Message Originator fields values into Message Metadata", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "fieldsMapping": { "name": "originatorName", "type": "originatorType" } }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbEnrichmentNodeOriginatorFieldsConfig", "icon": "", "iconUrl": "", "docUrl": "" } }, 
    "actions": null }, 
    { "id": { "id": "f5a37870-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "ENRICHMENT", "scope": "TENANT", "name": "related attributes", "clazz": "org.thingsboard.rule.engine.metadata.TbGetRelatedAttributeNode", "configurationDescriptor": { "nodeDefinition": { "details": "Related Entity found using configured relation direction and Relation Type. If multiple Related Entities are found, only first Entity is used for attributes enrichment, other entities are discarded. If Attributes enrichment configured, server scope attributes are added into Message metadata. If Latest Telemetry enrichment configured, latest telemetry added into metadata. To access those attributes in other nodes this template can be used <code>metadata.temperature</code>.", "description": "Add Originators Related Entity Attributes or Latest Telemetry into Message Metadata", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "attrMapping": { "temperature": "tempo" }, "relationsQuery": { "direction": "FROM", "maxLevel": 1, "filters": [{ "relationType": "Contains", "entityTypes": [] }] }, "telemetry": false }, "uiResources": ["static/rulenode/rulenode-core-config.js", "static/rulenode/rulenode-core-config.css"], "configDirective": "tbEnrichmentNodeRelatedAttributesConfig", "icon": "", "iconUrl": "", "docUrl": "" } }, 
    "actions": null },
    { "id": { "id": "f5adffc0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "ENRICHMENT", "scope": "TENANT", "name": "device attributes", "clazz": "org.thingsboard.rule.engine.metadata.TbGetDeviceAttrNode", "configurationDescriptor": { "nodeDefinition": { "details": "If Attributes enrichment configured, <b>CLIENT/SHARED/SERVER</b> attributes are added into Message metadata with specific prefix: <i>cs/shared/ss</i>. Latest telemetry value added into metadata without prefix. To access those attributes in other nodes this template can be used <code>metadata.cs_temperature</code> or <code>metadata.shared_limit</code> ", "description": "Add Originators Related Device Attributes and Latest Telemetry value into Message Metadata", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "clientAttributeNames": [], "sharedAttributeNames": [], "serverAttributeNames": [], "latestTsKeyNames": [], "deviceRelationsQuery": { "direction": "FROM", "maxLevel": 1, "relationType": "Contains", "deviceTypes": ["default"] } }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbEnrichmentNodeDeviceAttributesConfig", "icon": "", "iconUrl": "", "docUrl": "" } }, 
    "actions": null },
    { "id": { "id": "f5b1a940-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "ENRICHMENT", "scope": "TENANT", "name": "customer attributes", "clazz": "org.thingsboard.rule.engine.metadata.TbGetCustomerAttributeNode", "configurationDescriptor": { "nodeDefinition": { "details": "If Attributes enrichment configured, server scope attributes are added into Message metadata. If Latest Telemetry enrichment configured, latest telemetry added into metadata. To access those attributes in other nodes this template can be used <code>metadata.temperature</code>.", "description": "Add Originators Customer Attributes or Latest Telemetry into Message Metadata", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "attrMapping": { "temperature": "tempo" }, "telemetry": false }, "uiResources": ["static/rulenode/rulenode-core-config.js", "static/rulenode/rulenode-core-config.css"], "configDirective": "tbEnrichmentNodeCustomerAttributesConfig", "icon": "", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f57ae1d0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "EXTERNAL", "scope": "TENANT", "name": "rabbitmq", "clazz": "org.thingsboard.rule.engine.rabbitmq.TbRabbitMqNode", "configurationDescriptor": { "nodeDefinition": { "details": "Will publish message payload to RabbitMQ queue.", "description": "Publish messages to the RabbitMQ", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "exchangeNamePattern": "", "routingKeyPattern": "", "messageProperties": null, "host": "localhost", "port": 5672, "virtualHost": "/", "username": "guest", "password": "guest", "automaticRecoveryEnabled": false, "connectionTimeout": 60000, "handshakeTimeout": 10000, "clientProperties": {} }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeRabbitMqConfig", "icon": "", "iconUrl": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiIHZlcnNpb249IjEuMSIgeT0iMHB4IiB4PSIwcHgiIHZpZXdCb3g9IjAgMCAxMDAwIDEwMDAiPjxwYXRoIHN0cm9rZS13aWR0aD0iLjg0OTU2IiBkPSJtODYwLjQ3IDQxNi4zMmgtMjYyLjAxYy0xMi45MTMgMC0yMy42MTgtMTAuNzA0LTIzLjYxOC0yMy42MTh2LTI3Mi43MWMwLTIwLjMwNS0xNi4yMjctMzYuMjc2LTM2LjI3Ni0zNi4yNzZoLTkzLjc5MmMtMjAuMzA1IDAtMzYuMjc2IDE2LjIyNy0zNi4yNzYgMzYuMjc2djI3MC44NGMtMC4yNTQ4NyAxNC4xMDMtMTEuNDY5IDI1LjU3Mi0yNS43NDIgMjUuNTcybC04NS42MzYgMC42Nzk2NWMtMTQuMTAzIDAtMjUuNTcyLTExLjQ2OS0yNS41NzItMjUuNTcybDAuNjc5NjUtMjcxLjUyYzAtMjAuMzA1LTE2LjIyNy0zNi4yNzYtMzYuMjc2LTM2LjI3NmgtOTMuNTM3Yy0yMC4zMDUgMC0zNi4yNzYgMTYuMjI3LTM2LjI3NiAzNi4yNzZ2NzYzLjg0YzAgMTguMDk2IDE0Ljc4MiAzMi40NTMgMzIuNDUzIDMyLjQ1M2g3MjIuODFjMTguMDk2IDAgMzIuNDUzLTE0Ljc4MiAzMi40NTMtMzIuNDUzdi00MzUuMzFjLTEuMTg5NC0xOC4xODEtMTUuMjkyLTMyLjE5OC0zMy4zODgtMzIuMTk4em0tMTIyLjY4IDI4Ny4wN2MwIDIzLjYxOC0xOC44NiA0Mi40NzgtNDIuNDc4IDQyLjQ3OGgtNzMuOTk3Yy0yMy42MTggMC00Mi40NzgtMTguODYtNDIuNDc4LTQyLjQ3OHYtNzQuMjUyYzAtMjMuNjE4IDE4Ljg2LTQyLjQ3OCA0Mi40NzgtNDIuNDc4aDczLjk5N2MyMy42MTggMCA0Mi40NzggMTguODYgNDIuNDc4IDQyLjQ3OHoiLz48L3N2Zz4=", "docUrl": "" } }, "actions": null }, { "id": { "id": "f5860560-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "EXTERNAL", "scope": "TENANT", "name": "rest api call", "clazz": "org.thingsboard.rule.engine.rest.TbRestApiCallNode", "configurationDescriptor": { "nodeDefinition": { "details": "Will invoke REST API call <code>GET | POST | PUT | DELETE</code> to external REST server. Message payload added into Request body. Configured attributes can be added into Headers from Message Metadata. Outbound message will contain response fields (<code>status</code>, <code>statusCode</code>, <code>statusReason</code> and response <code>headers</code>) in the Message Metadata. Response body saved in outbound Message payload. For example <b>statusCode</b> field can be accessed with <code>metadata.statusCode</code>.", "description": "Invoke REST API calls to external REST server", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "restEndpointUrlPattern": "http://localhost/api", "requestMethod": "POST", "headers": {} }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeRestApiCallConfig", "icon": "", "iconUrl": "data:image/svg+xml;base64,PHN2ZyBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB2ZXJzaW9uPSIxLjEiIHk9IjBweCIgeD0iMHB4Ij48ZyB0cmFuc2Zvcm09Im1hdHJpeCguOTQ5NzUgMCAwIC45NDk3NSAxNy4xMiAyNi40OTIpIj48cGF0aCBkPSJtMTY5LjExIDEwOC41NGMtOS45MDY2IDAuMDczNC0xOS4wMTQgNi41NzI0LTIyLjAxNCAxNi40NjlsLTY5Ljk5MyAyMzEuMDhjLTMuNjkwNCAxMi4xODEgMy4yODkyIDI1LjIyIDE1LjQ2OSAyOC45MSAyLjIyNTkgMC42NzQ4MSA0LjQ5NjkgMSA2LjcyODUgMSA5Ljk3MjEgMCAxOS4xNjUtNi41MTUzIDIyLjE4Mi0xNi40NjdhNi41MjI0IDYuNTIyNCAwIDAgMCAwLjAwMiAtMC4wMDJsNjkuOTktMjMxLjA3YTYuNTIyNCA2LjUyMjQgMCAwIDAgMCAtMC4wMDJjMy42ODU1LTEyLjE4MS0zLjI4Ny0yNS4yMjUtMTUuNDcxLTI4LjkxMi0yLjI4MjUtMC42OTE0NS00LjYxMTYtMS4wMTY5LTYuODk4NC0xem04NC45ODggMGMtOS45MDQ4IDAuMDczNC0xOS4wMTggNi41Njc1LTIyLjAxOCAxNi40NjlsLTY5Ljk4NiAyMzEuMDhjLTMuNjg5OCAxMi4xNzkgMy4yODUzIDI1LjIxNyAxNS40NjUgMjguOTA4IDIuMjI5NyAwLjY3NjQ3IDQuNTAwOCAxLjAwMiA2LjczMjQgMS4wMDIgOS45NzIxIDAgMTkuMTY1LTYuNTE1MyAyMi4xODItMTYuNDY3YTYuNTIyNCA2LjUyMjQgMCAwIDAgMC4wMDIgLTAuMDAybDY5Ljk4OC0yMzEuMDdjMy42OTA4LTEyLjE4MS0zLjI4NTItMjUuMjIzLTE1LjQ2Ny0yOC45MTItMi4yODE0LTAuNjkyMzEtNC42MTA4LTEuMDE4OS02Ljg5ODQtMS4wMDJ6bS0yMTcuMjkgNDIuMjNjLTEyLjcyOS0wLjAwMDg3LTIzLjE4OCAxMC40NTYtMjMuMTg4IDIzLjE4NiAwLjAwMSAxMi43MjggMTAuNDU5IDIzLjE4NiAyMy4xODggMjMuMTg2IDEyLjcyNy0wLjAwMSAyMy4xODMtMTAuNDU5IDIzLjE4NC0yMy4xODYgMC4wMDA4NzYtMTIuNzI4LTEwLjQ1Ni0yMy4xODUtMjMuMTg0LTIzLjE4NnptMCAxNDYuNjRjLTEyLjcyNy0wLjAwMDg3LTIzLjE4NiAxMC40NTUtMjMuMTg4IDIzLjE4NC0wLjAwMDg3MyAxMi43MjkgMTAuNDU4IDIzLjE4OCAyMy4xODggMjMuMTg4IDEyLjcyOC0wLjAwMSAyMy4xODQtMTAuNDYgMjMuMTg0LTIzLjE4OC0wLjAwMS0xMi43MjYtMTAuNDU3LTIzLjE4My0yMy4xODQtMjMuMTg0em0yNzAuNzkgNDIuMjExYy0xMi43MjcgMC0yMy4xODQgMTAuNDU3LTIzLjE4NCAyMy4xODRzMTAuNDU1IDIzLjE4OCAyMy4xODQgMjMuMTg4aDE1NC45OGMxMi43MjkgMCAyMy4xODYtMTAuNDYgMjMuMTg2LTIzLjE4OCAwLjAwMS0xMi43MjgtMTAuNDU4LTIzLjE4NC0yMy4xODYtMjMuMTg0eiIgdHJhbnNmb3JtPSJtYXRyaXgoMS4wMzc2IDAgMCAxLjAzNzYgLTcuNTY3NiAtMTQuOTI1KSIgc3Ryb2tlLXdpZHRoPSIxLjI2OTMiLz48L2c+PC9zdmc+", "docUrl": "" } }, "actions": null }, { "id": { "id": "f59c2570-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "EXTERNAL", "scope": "TENANT", "name": "mqtt", "clazz": "org.thingsboard.rule.engine.mqtt.TbMqttNode", "configurationDescriptor": { "nodeDefinition": { "details": "Will publish message payload to the MQTT broker with QoS <b>AT_LEAST_ONCE</b>.", "description": "Publish messages to the MQTT broker", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "topicPattern": "my-topic", "host": "localhost", "port": 1883, "connectTimeoutSec": 10, "clientId": null, "cleanSession": true, "ssl": false, "credentials": { "type": "anonymous" } }, "uiResources": ["static/rulenode/rulenode-core-config.js", "static/rulenode/rulenode-core-config.css"], "configDirective": "tbActionNodeMqttConfig", "icon": "call_split", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f59e4850-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "EXTERNAL", "scope": "TENANT", "name": "kafka", "clazz": "org.thingsboard.rule.engine.kafka.TbKafkaNode", "configurationDescriptor": { "nodeDefinition": { "details": "Will send record via Kafka producer to Kafka server. Outbound message will contain response fields (<code>offset</code>, <code>partition</code>, <code>topic</code>) from the Kafka in the Message Metadata. For example <b>partition</b> field can be accessed with <code>metadata.partition</code>.", "description": "Publish messages to Kafka server", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "topicPattern": "my-topic", "bootstrapServers": "localhost:9092", "retries": 0, "batchSize": 16384, "linger": 0, "bufferMemory": 33554432, "acks": "-1", "keySerializer": "org.apache.kafka.common.serialization.StringSerializer", "valueSerializer": "org.apache.kafka.common.serialization.StringSerializer", "otherProperties": {} }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeKafkaConfig", "icon": "", "iconUrl": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUzOCIgaGVpZ2h0PSIyNTAwIiB2aWV3Qm94PSIwIDAgMjU2IDQxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCI+PHBhdGggZD0iTTIwMS44MTYgMjMwLjIxNmMtMTYuMTg2IDAtMzAuNjk3IDcuMTcxLTQwLjYzNCAxOC40NjFsLTI1LjQ2My0xOC4wMjZjMi43MDMtNy40NDIgNC4yNTUtMTUuNDMzIDQuMjU1LTIzLjc5NyAwLTguMjE5LTEuNDk4LTE2LjA3Ni00LjExMi0yMy40MDhsMjUuNDA2LTE3LjgzNWM5LjkzNiAxMS4yMzMgMjQuNDA5IDE4LjM2NSA0MC41NDggMTguMzY1IDI5Ljg3NSAwIDU0LjE4NC0yNC4zMDUgNTQuMTg0LTU0LjE4NCAwLTI5Ljg3OS0yNC4zMDktNTQuMTg0LTU0LjE4NC01NC4xODQtMjkuODc1IDAtNTQuMTg0IDI0LjMwNS01NC4xODQgNTQuMTg0IDAgNS4zNDguODA4IDEwLjUwNSAyLjI1OCAxNS4zODlsLTI1LjQyMyAxNy44NDRjLTEwLjYyLTEzLjE3NS0yNS45MTEtMjIuMzc0LTQzLjMzMy0yNS4xODJ2LTMwLjY0YzI0LjU0NC01LjE1NSA0My4wMzctMjYuOTYyIDQzLjAzNy01My4wMTlDMTI0LjE3MSAyNC4zMDUgOTkuODYyIDAgNjkuOTg3IDAgNDAuMTEyIDAgMTUuODAzIDI0LjMwNSAxNS44MDMgNTQuMTg0YzAgMjUuNzA4IDE4LjAxNCA0Ny4yNDYgNDIuMDY3IDUyLjc2OXYzMS4wMzhDMjUuMDQ0IDE0My43NTMgMCAxNzIuNDAxIDAgMjA2Ljg1NGMwIDM0LjYyMSAyNS4yOTIgNjMuMzc0IDU4LjM1NSA2OC45NHYzMi43NzRjLTI0LjI5OSA1LjM0MS00Mi41NTIgMjcuMDExLTQyLjU1MiA1Mi44OTQgMCAyOS44NzkgMjQuMzA5IDU0LjE4NCA1NC4xODQgNTQuMTg0IDI5Ljg3NSAwIDU0LjE4NC0yNC4zMDUgNTQuMTg0LTU0LjE4NCAwLTI1Ljg4My0xOC4yNTMtNDcuNTUzLTQyLjU1Mi01Mi44OTR2LTMyLjc3NWE2OS45NjUgNjkuOTY1IDAgMCAwIDQyLjYtMjQuNzc2bDI1LjYzMyAxOC4xNDNjLTEuNDIzIDQuODQtMi4yMiA5Ljk0Ni0yLjIyIDE1LjI0IDAgMjkuODc5IDI0LjMwOSA1NC4xODQgNTQuMTg0IDU0LjE4NCAyOS44NzUgMCA1NC4xODQtMjQuMzA1IDU0LjE4NC01NC4xODQgMC0yOS44NzktMjQuMzA5LTU0LjE4NC01NC4xODQtNTQuMTg0em0wLTEyNi42OTVjMTQuNDg3IDAgMjYuMjcgMTEuNzg4IDI2LjI3IDI2LjI3MXMtMTEuNzgzIDI2LjI3LTI2LjI3IDI2LjI3LTI2LjI3LTExLjc4Ny0yNi4yNy0yNi4yN2MwLTE0LjQ4MyAxMS43ODMtMjYuMjcxIDI2LjI3LTI2LjI3MXptLTE1OC4xLTQ5LjMzN2MwLTE0LjQ4MyAxMS43ODQtMjYuMjcgMjYuMjcxLTI2LjI3czI2LjI3IDExLjc4NyAyNi4yNyAyNi4yN2MwIDE0LjQ4My0xMS43ODMgMjYuMjctMjYuMjcgMjYuMjdzLTI2LjI3MS0xMS43ODctMjYuMjcxLTI2LjI3em01Mi41NDEgMzA3LjI3OGMwIDE0LjQ4My0xMS43ODMgMjYuMjctMjYuMjcgMjYuMjdzLTI2LjI3MS0xMS43ODctMjYuMjcxLTI2LjI3YzAtMTQuNDgzIDExLjc4NC0yNi4yNyAyNi4yNzEtMjYuMjdzMjYuMjcgMTEuNzg3IDI2LjI3IDI2LjI3em0tMjYuMjcyLTExNy45N2MtMjAuMjA1IDAtMzYuNjQyLTE2LjQzNC0zNi42NDItMzYuNjM4IDAtMjAuMjA1IDE2LjQzNy0zNi42NDIgMzYuNjQyLTM2LjY0MiAyMC4yMDQgMCAzNi42NDEgMTYuNDM3IDM2LjY0MSAzNi42NDIgMCAyMC4yMDQtMTYuNDM3IDM2LjYzOC0zNi42NDEgMzYuNjM4em0xMzEuODMxIDY3LjE3OWMtMTQuNDg3IDAtMjYuMjctMTEuNzg4LTI2LjI3LTI2LjI3MXMxMS43ODMtMjYuMjcgMjYuMjctMjYuMjcgMjYuMjcgMTEuNzg3IDI2LjI3IDI2LjI3YzAgMTQuNDgzLTExLjc4MyAyNi4yNzEtMjYuMjcgMjYuMjcxeiIvPjwvc3ZnPg==", "docUrl": "" } }, "actions": null }, { "id": { "id": "f5a1cac0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "EXTERNAL", "scope": "TENANT", "name": "aws sqs", "clazz": "org.thingsboard.rule.engine.aws.sqs.TbSqsNode", "configurationDescriptor": { "nodeDefinition": { "details": "Will publish message payload and metadata attributes to the AWS SQS queue. Outbound message will contain response fields (<code>messageId</code>, <code>requestId</code>, <code>messageBodyMd5</code>, <code>messageAttributesMd5</code>, <code>sequenceNumber</code>) in the Message Metadata from the AWS SQS. For example <b>requestId</b> field can be accessed with <code>metadata.requestId</code>.", "description": "Publish messages to the AWS SQS", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "queueType": "STANDARD", "queueUrlPattern": "https://sqs.us-east-1.amazonaws.com/123456789012/my-queue-name", "delaySeconds": 0, "messageAttributes": {}, "accessKeyId": null, "secretAccessKey": null, "region": "us-east-1" }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeSqsConfig", "icon": "", "iconUrl": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4Ij48cGF0aCBkPSJNMTMuMjMgMTAuNTZWMTBjLTEuOTQgMC0zLjk5LjM5LTMuOTkgMi42NyAwIDEuMTYuNjEgMS45NSAxLjYzIDEuOTUuNzYgMCAxLjQzLS40NyAxLjg2LTEuMjIuNTItLjkzLjUtMS44LjUtMi44NG0yLjcgNi41M2MtLjE4LjE2LS40My4xNy0uNjMuMDYtLjg5LS43NC0xLjA1LTEuMDgtMS41NC0xLjc5LTEuNDcgMS41LTIuNTEgMS45NS00LjQyIDEuOTUtMi4yNSAwLTQuMDEtMS4zOS00LjAxLTQuMTcgMC0yLjE4IDEuMTctMy42NCAyLjg2LTQuMzggMS40Ni0uNjQgMy40OS0uNzYgNS4wNC0uOTNWNy41YzAtLjY2LjA1LTEuNDEtLjMzLTEuOTYtLjMyLS40OS0uOTUtLjctMS41LS43LTEuMDIgMC0xLjkzLjUzLTIuMTUgMS42MS0uMDUuMjQtLjI1LjQ4LS40Ny40OWwtMi42LS4yOGMtLjIyLS4wNS0uNDYtLjIyLS40LS41Ni42LTMuMTUgMy40NS00LjEgNi00LjEgMS4zIDAgMyAuMzUgNC4wMyAxLjMzQzE3LjExIDQuNTUgMTcgNi4xOCAxNyA3Ljk1djQuMTdjMCAxLjI1LjUgMS44MSAxIDIuNDguMTcuMjUuMjEuNTQgMCAuNzFsLTIuMDYgMS43OGgtLjAxIj48L3BhdGg+PHBhdGggZD0iTTIwLjE2IDE5LjU0QzE4IDIxLjE0IDE0LjgyIDIyIDEyLjEgMjJjLTMuODEgMC03LjI1LTEuNDEtOS44NS0zLjc2LS4yLS4xOC0uMDItLjQzLjI1LS4yOSAyLjc4IDEuNjMgNi4yNSAyLjYxIDkuODMgMi42MSAyLjQxIDAgNS4wNy0uNSA3LjUxLTEuNTMuMzctLjE2LjY2LjI0LjMyLjUxIj48L3BhdGg+PHBhdGggZD0iTTIxLjA3IDE4LjVjLS4yOC0uMzYtMS44NS0uMTctMi41Ny0uMDgtLjE5LjAyLS4yMi0uMTYtLjAzLS4zIDEuMjQtLjg4IDMuMjktLjYyIDMuNTMtLjMzLjI0LjMtLjA3IDIuMzUtMS4yNCAzLjMyLS4xOC4xNi0uMzUuMDctLjI2LS4xMS4yNi0uNjcuODUtMi4xNC41Ny0yLjV6Ij48L3BhdGg+PC9zdmc+", "docUrl": "" } }, "actions": null }, { "id": { "id": "f5a61080-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "EXTERNAL", "scope": "TENANT", "name": "aws sns", "clazz": "org.thingsboard.rule.engine.aws.sns.TbSnsNode", "configurationDescriptor": { "nodeDefinition": { "details": "Will publish message payload to the AWS SNS topic. Outbound message will contain response fields (<code>messageId</code>, <code>requestId</code>) in the Message Metadata from the AWS SNS. For example <b>requestId</b> field can be accessed with <code>metadata.requestId</code>.", "description": "Publish message to the AWS SNS", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "topicArnPattern": "arn:aws:sns:us-east-1:123456789012:MyNewTopic", "accessKeyId": null, "secretAccessKey": null, "region": "us-east-1" }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeSnsConfig", "icon": "", "iconUrl": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4Ij48cGF0aCBkPSJNMTMuMjMgMTAuNTZWMTBjLTEuOTQgMC0zLjk5LjM5LTMuOTkgMi42NyAwIDEuMTYuNjEgMS45NSAxLjYzIDEuOTUuNzYgMCAxLjQzLS40NyAxLjg2LTEuMjIuNTItLjkzLjUtMS44LjUtMi44NG0yLjcgNi41M2MtLjE4LjE2LS40My4xNy0uNjMuMDYtLjg5LS43NC0xLjA1LTEuMDgtMS41NC0xLjc5LTEuNDcgMS41LTIuNTEgMS45NS00LjQyIDEuOTUtMi4yNSAwLTQuMDEtMS4zOS00LjAxLTQuMTcgMC0yLjE4IDEuMTctMy42NCAyLjg2LTQuMzggMS40Ni0uNjQgMy40OS0uNzYgNS4wNC0uOTNWNy41YzAtLjY2LjA1LTEuNDEtLjMzLTEuOTYtLjMyLS40OS0uOTUtLjctMS41LS43LTEuMDIgMC0xLjkzLjUzLTIuMTUgMS42MS0uMDUuMjQtLjI1LjQ4LS40Ny40OWwtMi42LS4yOGMtLjIyLS4wNS0uNDYtLjIyLS40LS41Ni42LTMuMTUgMy40NS00LjEgNi00LjEgMS4zIDAgMyAuMzUgNC4wMyAxLjMzQzE3LjExIDQuNTUgMTcgNi4xOCAxNyA3Ljk1djQuMTdjMCAxLjI1LjUgMS44MSAxIDIuNDguMTcuMjUuMjEuNTQgMCAuNzFsLTIuMDYgMS43OGgtLjAxIj48L3BhdGg+PHBhdGggZD0iTTIwLjE2IDE5LjU0QzE4IDIxLjE0IDE0LjgyIDIyIDEyLjEgMjJjLTMuODEgMC03LjI1LTEuNDEtOS44NS0zLjc2LS4yLS4xOC0uMDItLjQzLjI1LS4yOSAyLjc4IDEuNjMgNi4yNSAyLjYxIDkuODMgMi42MSAyLjQxIDAgNS4wNy0uNSA3LjUxLTEuNTMuMzctLjE2LjY2LjI0LjMyLjUxIj48L3BhdGg+PHBhdGggZD0iTTIxLjA3IDE4LjVjLS4yOC0uMzYtMS44NS0uMTctMi41Ny0uMDgtLjE5LjAyLS4yMi0uMTYtLjAzLS4zIDEuMjQtLjg4IDMuMjktLjYyIDMuNTMtLjMzLjI0LjMtLjA3IDIuMzUtMS4yNCAzLjMyLS4xOC4xNi0uMzUuMDctLjI2LS4xMS4yNi0uNjcuODUtMi4xNC41Ny0yLjV6Ij48L3BhdGg+PC9zdmc+", "docUrl": "" } }, "actions": null }, { "id": { "id": "f5b0bee0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "EXTERNAL", "scope": "TENANT", "name": "send email", "clazz": "org.thingsboard.rule.engine.mail.TbSendEmailNode", "configurationDescriptor": { "nodeDefinition": { "details": "Expects messages with <b>SEND_EMAIL</b> type. Node works only with messages that  where created using <code>to Email</code> transformation Node, please connect this Node with <code>to Email</code> Node using <code>Successful</code> chain.", "description": "Sends email message via SMTP server.", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "useSystemSmtpSettings": true, "smtpHost": "localhost", "smtpPort": 25, "username": null, "password": null, "smtpProtocol": "smtp", "timeout": 10000, "enableTls": false }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeSendEmailConfig", "icon": "send", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f55de3f0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "ACTION", "scope": "TENANT", "name": "generator", "clazz": "org.thingsboard.rule.engine.debug.TbMsgGeneratorNode", "configurationDescriptor": { "nodeDefinition": { "details": "Generates messages with configurable period. Javascript function used for message generation.", "description": "Periodically generates messages", "inEnabled": false, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "msgCount": 0, "periodInSeconds": 1, "originatorId": null, "originatorType": null, "jsScript": "var msg = { temp: 42, humidity: 77 };\nvar metadata = { data: 40 };\nvar msgType = \"POST_TELEMETRY_REQUEST\";\n\nreturn { msg: msg, metadata: metadata, msgType: msgType };" }, "uiResources": ["static/rulenode/rulenode-core-config.js", "static/rulenode/rulenode-core-config.css"], "configDirective": "tbActionNodeGeneratorConfig", "icon": "repeat", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f5727d60-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "ACTION", "scope": "TENANT", "name": "rpc call reply", "clazz": "org.thingsboard.rule.engine.rpc.TbSendRPCReplyNode", "configurationDescriptor": { "nodeDefinition": { "details": "Expects messages with any message type. Will forward message body to the device.", "description": "Sends reply to RPC call from device", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "requestIdMetaDataAttribute": "requestId" }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeRpcReplyConfig", "icon": "call_merge", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f5747930-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "ACTION", "scope": "TENANT", "name": "create alarm", "clazz": "org.thingsboard.rule.engine.action.TbCreateAlarmNode", "configurationDescriptor": { "nodeDefinition": { "details": "Details - JS function that creates JSON object based on incoming message. This object will be added into Alarm.details field.\nNode output:\nIf alarm was not created, original message is returned. Otherwise new Message returned with type 'ALARM', Alarm object in 'msg' property and 'matadata' will contains one of those properties 'isNewAlarm/isExistingAlarm'. Message payload can be accessed via <code>msg</code> property. For example <code>'temperature = ' + msg.temperature ;</code>. Message metadata can be accessed via <code>metadata</code> property. For example <code>'name = ' + metadata.customerName;</code>.", "description": "Create or Update Alarm", "inEnabled": true, "outEnabled": true, "relationTypes": ["Created", "Updated", "False", "Failure"], "customRelations": false, "defaultConfiguration": { "alarmType": "General Alarm", "alarmDetailsBuildJs": "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n}\nreturn details;", "severity": "CRITICAL", "propagate": false }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeCreateAlarmConfig", "icon": "notifications_active", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f577ad80-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "ACTION", "scope": "TENANT", "name": "delay", "clazz": "org.thingsboard.rule.engine.delay.TbMsgDelayNode", "configurationDescriptor": { "nodeDefinition": { "details": "Delays messages for configurable period.", "description": "Delays incoming message", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "periodInSeconds": 60, "maxPendingMsgs": 1000 }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeMsgDelayConfig", "icon": "pause", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "cb065bc0-f933-11e8-b99e-ed06b57bf26f" }, "createdTime": 0, "type": "ACTION", "scope": "TENANT", "name": "message count", "clazz": "org.thingsboard.rule.engine.action.TbMsgCountNode", "configurationDescriptor": { "nodeDefinition": { "details": "Count incoming messages for specified interval and produces POST_TELEMETRY_REQUEST msg with messages count", "description": "Count incoming messages", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "telemetryPrefix": "messageCount", "interval": 1 }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeMsgCountConfig", "icon": "functions", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f57c6870-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "ACTION", "scope": "TENANT", "name": "save timeseries", "clazz": "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode", "configurationDescriptor": { "nodeDefinition": { "details": "Saves timeseries telemetry data based on configurable TTL parameter. Expects messages with 'POST_TELEMETRY_REQUEST' message type", "description": "Saves timeseries data", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "defaultTTL": 0 }, "uiResources": ["static/rulenode/rulenode-core-config.js", "static/rulenode/rulenode-core-config.css"], "configDirective": "tbActionNodeTimeseriesConfig", "icon": "file_upload", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f58bd1c0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "ACTION", "scope": "TENANT", "name": "copy to view", "clazz": "org.thingsboard.rule.engine.action.TbCopyAttributesToEntityViewNode", "configurationDescriptor": { "nodeDefinition": { "details": "Copy attributes from asset/device to related entity view according to entity view configuration. \n Copy will be done only for attributes that are between start and end dates and according to attribute keys configuration. \nChanges message originator to related entity view and produces new messages according to count of updated entity views", "description": "Copy attributes from asset/device to entity view and changes message originator to related entity view", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "version": 0 }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbNodeEmptyConfig", "icon": "content_copy", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f5abdce0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "ACTION", "scope": "TENANT", "name": "save attributes", "clazz": "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode", "configurationDescriptor": { "nodeDefinition": { "details": "Saves entity attributes based on configurable scope parameter. Expects messages with 'POST_ATTRIBUTES_REQUEST' message type", "description": "Saves attributes data", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "scope": "SERVER_SCOPE" }, "uiResources": ["static/rulenode/rulenode-core-config.js", "static/rulenode/rulenode-core-config.css"], "configDirective": "tbActionNodeAttributesConfig", "icon": "file_upload", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f5af3840-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "ACTION", "scope": "TENANT", "name": "log", "clazz": "org.thingsboard.rule.engine.action.TbLogNode", "configurationDescriptor": { "nodeDefinition": { "details": "Transform incoming Message with configured JS function to String and log final value into Thingsboard log file. Message payload can be accessed via <code>msg</code> property. For example <code>'temperature = ' + msg.temperature ;</code>. Message metadata can be accessed via <code>metadata</code> property. For example <code>'name = ' + metadata.customerName;</code>.", "description": "Log incoming messages using JS script for transformation Message into String", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "jsScript": "return 'Incoming message:\\n' + JSON.stringify(msg) + '\\nIncoming metadata:\\n' + JSON.stringify(metadata);" }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeLogConfig", "icon": "menu", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "cb31d890-f933-11e8-b99e-ed06b57bf26f" }, "createdTime": 0, "type": "ACTION", "scope": "TENANT", "name": "unassign from customer", "clazz": "org.thingsboard.rule.engine.action.TbUnassignFromCustomerNode", "configurationDescriptor": { "nodeDefinition": { "details": "Finds target Entity Customer by Customer name pattern and then unassign Originator Entity from this customer.", "description": "Unassign Message Originator Entity from Customer", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "customerNamePattern": "", "customerCacheExpiration": 300 }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeUnAssignToCustomerConfig", "icon": "remove_circle", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f5b3cc20-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "ACTION", "scope": "TENANT", "name": "clear alarm", "clazz": "org.thingsboard.rule.engine.action.TbClearAlarmNode", "configurationDescriptor": { "nodeDefinition": { "details": "Details - JS function that creates JSON object based on incoming message. This object will be added into Alarm.details field.\nNode output:\nIf alarm was not cleared, original message is returned. Otherwise new Message returned with type 'ALARM', Alarm object in 'msg' property and 'matadata' will contains 'isClearedAlarm' property. Message payload can be accessed via <code>msg</code> property. For example <code>'temperature = ' + msg.temperature ;</code>. Message metadata can be accessed via <code>metadata</code> property. For example <code>'name = ' + metadata.customerName;</code>.", "description": "Clear Alarm", "inEnabled": true, "outEnabled": true, "relationTypes": ["Cleared", "False", "Failure"], "customRelations": false, "defaultConfiguration": { "alarmType": "General Alarm", "alarmDetailsBuildJs": "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n}\nreturn details;" }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeClearAlarmConfig", "icon": "notifications_off", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "cb358210-f933-11e8-b99e-ed06b57bf26f" }, "createdTime": 0, "type": "ACTION", "scope": "TENANT", "name": "assign to customer", "clazz": "org.thingsboard.rule.engine.action.TbAssignToCustomerNode", "configurationDescriptor": { "nodeDefinition": { "details": "Finds target Customer by customer name pattern and then assign Originator Entity to this customer. Will create new Customer if it doesn't exists and 'Create new Customer if not exists' is set to true.", "description": "Assign Message Originator Entity to Customer", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "customerNamePattern": "", "customerCacheExpiration": 300, "createCustomerIfNotExists": false }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeAssignToCustomerConfig", "icon": "add_circle", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f5b504a0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "ACTION", "scope": "TENANT", "name": "rpc call request", "clazz": "org.thingsboard.rule.engine.rpc.TbSendRPCRequestNode", "configurationDescriptor": { "nodeDefinition": { "details": "Expects messages with \"method\" and \"params\". Will forward response from device to next nodes.If the RPC call request is originated by REST API call from user, will forward the response to user immediately.", "description": "Sends RPC call to device", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "timeoutInSeconds": 60 }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbActionNodeRpcRequestConfig", "icon": "call_made", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f58011f0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "TRANSFORMATION", "scope": "TENANT", "name": "change originator", "clazz": "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode", "configurationDescriptor": { "nodeDefinition": { "details": "Related Entity found using configured relation direction and Relation Type. If multiple Related Entities are found, only first Entity is used as new Originator, other entities are discarded. ", "description": "Change Message Originator To Tenant/Customer/Related Entity", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "originatorSource": "CUSTOMER", "relationsQuery": { "direction": "FROM", "maxLevel": 1, "filters": [{ "relationType": "Contains", "entityTypes": [] }] } }, "uiResources": ["static/rulenode/rulenode-core-config.js", "static/rulenode/rulenode-core-config.css"], "configDirective": "tbTransformationNodeChangeOriginatorConfig", "icon": "find_replace", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f5a4b0f0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "TRANSFORMATION", "scope": "TENANT", "name": "script", "clazz": "org.thingsboard.rule.engine.transform.TbTransformMsgNode", "configurationDescriptor": { "nodeDefinition": { "details": "JavaScript function receive 3 input parameters <br/> <code>metadata</code> - is a Message metadata.<br/><code>msg</code> - is a Message payload.<br/><code>msgType</code> - is a Message type.<br/>Should return the following structure:<br/><code>{ msg: <i style=\"color: #666;\">new payload</i>,<br/>&nbsp&nbsp&nbspmetadata: <i style=\"color: #666;\">new metadata</i>,<br/>&nbsp&nbsp&nbspmsgType: <i style=\"color: #666;\">new msgType</i> }</code><br/>All fields in resulting object are optional and will be taken from original message if not specified.", "description": "Change Message payload, Metadata or Message type using JavaScript", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "jsScript": "return {msg: msg, metadata: metadata, msgType: msgType};" }, "uiResources": ["static/rulenode/rulenode-core-config.js", "static/rulenode/rulenode-core-config.css"], "configDirective": "tbTransformationNodeScriptConfig", "icon": "", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f5aacb70-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "TRANSFORMATION", "scope": "TENANT", "name": "to email", "clazz": "org.thingsboard.rule.engine.mail.TbMsgToEmailNode", "configurationDescriptor": { "nodeDefinition": { "details": "Transforms message to email message by populating email fields using values derived from message metadata. Set 'SEND_EMAIL' output message type.", "description": "Transforms message to email message", "inEnabled": true, "outEnabled": true, "relationTypes": ["Success", "Failure"], "customRelations": false, "defaultConfiguration": { "fromTemplate": "info@testmail.org", "toTemplate": "${userEmail}", "ccTemplate": null, "bccTemplate": null, "subjectTemplate": "Device ${deviceType} temperature high", "bodyTemplate": "Device ${deviceName} has high temperature ${temp}" }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbTransformationNodeToEmailConfig", "icon": "email", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f570f6c0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "FILTER", "scope": "TENANT", "name": "originator type", "clazz": "org.thingsboard.rule.engine.filter.TbOriginatorTypeFilterNode", "configurationDescriptor": { "nodeDefinition": { "details": "If Originator Type of incoming message is expected - send Message via <b>True</b> chain, otherwise <b>False</b> chain is used.", "description": "Filter incoming messages by message Originator Type", "inEnabled": true, "outEnabled": true, "relationTypes": ["True", "False", "Failure"], "customRelations": false, "defaultConfiguration": { "originatorTypes": ["DEVICE"] }, "uiResources": ["static/rulenode/rulenode-core-config.js", "static/rulenode/rulenode-core-config.css"], "configDirective": "tbFilterNodeOriginatorTypeConfig", "icon": "", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f57626e0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "FILTER", "scope": "TENANT", "name": "originator type switch", "clazz": "org.thingsboard.rule.engine.filter.TbOriginatorTypeSwitchNode", "configurationDescriptor": { "nodeDefinition": { "details": "Routes messages to chain according to the originator type ('Device', 'Asset', etc.).", "description": "Route incoming messages by Message Originator Type", "inEnabled": true, "outEnabled": true, "relationTypes": ["Device", "Asset", "Tenant", "Customer", "User", "Dashboard", "Rule chain", "Rule node", "Failure"], "customRelations": false, "defaultConfiguration": { "version": 0 }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbNodeEmptyConfig", "icon": "", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f57dc800-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "FILTER", "scope": "TENANT", "name": "script", "clazz": "org.thingsboard.rule.engine.filter.TbJsFilterNode", "configurationDescriptor": { "nodeDefinition": { "details": "Evaluate incoming Message with configured JS condition. If <b>True</b> - send Message via <b>True</b> chain, otherwise <b>False</b> chain is used.Message payload can be accessed via <code>msg</code> property. For example <code>msg.temperature < 10;</code><br/>Message metadata can be accessed via <code>metadata</code> property. For example <code>metadata.customerName === 'John';</code><br/>Message type can be accessed via <code>msgType</code> property.", "description": "Filter incoming messages using JS script", "inEnabled": true, "outEnabled": true, "relationTypes": ["True", "False", "Failure"], "customRelations": false, "defaultConfiguration": { "jsScript": "return msg.temperature > 20;" }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbFilterNodeScriptConfig", "icon": "", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f589aee0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "FILTER", "scope": "TENANT", "name": "switch", "clazz": "org.thingsboard.rule.engine.filter.TbJsSwitchNode", "configurationDescriptor": { "nodeDefinition": { "details": "Node executes configured JS script. Script should return array of next Chain names where Message should be routed. If Array is empty - message not routed to next Node. Message payload can be accessed via <code>msg</code> property. For example <code>msg.temperature < 10;</code><br/>Message metadata can be accessed via <code>metadata</code> property. For example <code>metadata.customerName === 'John';</code><br/>Message type can be accessed via <code>msgType</code> property.", "description": "Route incoming Message to one or multiple output chains", "inEnabled": true, "outEnabled": true, "relationTypes": ["Failure"], "customRelations": true, "defaultConfiguration": { "jsScript": "function nextRelation(metadata, msg) {\n    return ['one','nine'];\n}\nif(msgType === 'POST_TELEMETRY_REQUEST') {\n    return ['two'];\n}\nreturn nextRelation(metadata, msg);" }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbFilterNodeSwitchConfig", "icon": "", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f59101e0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "FILTER", "scope": "TENANT", "name": "message type", "clazz": "org.thingsboard.rule.engine.filter.TbMsgTypeFilterNode", "configurationDescriptor": { "nodeDefinition": { "details": "If incoming MessageType is expected - send Message via <b>True</b> chain, otherwise <b>False</b> chain is used.", "description": "Filter incoming messages by Message Type", "inEnabled": true, "outEnabled": true, "relationTypes": ["True", "False", "Failure"], "customRelations": false, "defaultConfiguration": { "messageTypes": ["POST_ATTRIBUTES_REQUEST", "POST_TELEMETRY_REQUEST", "TO_SERVER_RPC_REQUEST"] }, "uiResources": ["static/rulenode/rulenode-core-config.js", "static/rulenode/rulenode-core-config.css"], "configDirective": "tbFilterNodeMessageTypeConfig", "icon": "", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f5a85a70-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "FILTER", "scope": "TENANT", "name": "check relation", "clazz": "org.thingsboard.rule.engine.filter.TbCheckRelationNode", "configurationDescriptor": { "nodeDefinition": { "details": "If relation exists - send Message via <b>True</b> chain, otherwise <b>False</b> chain is used.", "description": "Checks the relation from the selected entity to originator of the message by type and direction", "inEnabled": true, "outEnabled": true, "relationTypes": ["True", "False", "Failure"], "customRelations": false, "defaultConfiguration": { "direction": "FROM", "entityId": null, "entityType": null, "relationType": "Contains" }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbFilterNodeCheckRelationConfig", "icon": "", "iconUrl": "", "docUrl": "" } }, "actions": null }, { "id": { "id": "f5b293a0-dd0b-11e8-9764-d533b1141d19" }, "createdTime": 0, "type": "FILTER", "scope": "TENANT", "name": "message type switch", "clazz": "org.thingsboard.rule.engine.filter.TbMsgTypeSwitchNode", "configurationDescriptor": { "nodeDefinition": { "details": "Sends messages with message types <b>\"Post attributes\", \"Post telemetry\", \"RPC Request\"</b> etc. via corresponding chain, otherwise <b>Other</b> chain is used.", "description": "Route incoming messages by Message Type", "inEnabled": true, "outEnabled": true, "relationTypes": ["Post attributes", "Post telemetry", "RPC Request from Device", "RPC Request to Device", "Activity Event", "Inactivity Event", "Connect Event", "Disconnect Event", "Entity Created", "Entity Updated", "Entity Deleted", "Entity Assigned", "Entity Unassigned", "Attributes Updated", "Attributes Deleted", "Alarm Acknowledged", "Alarm Cleared", "Other", "Failure"], "customRelations": false, "defaultConfiguration": { "version": 0 }, "uiResources": ["static/rulenode/rulenode-core-config.js"], "configDirective": "tbNodeEmptyConfig", "icon": "", "iconUrl": "", "docUrl": "" } }, "actions": null }]
    */